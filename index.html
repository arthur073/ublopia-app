<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="css/style.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/promise.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>

    <title>Ublopia</title>
</head>
<body>



<div class="navbar navbar-inverse">
    <div class="navbar-inner">
        <a class="brand" href="#">Ublopia</a>
        <div id="loader"  style="display: none;">
            <img src="img/ajax-loader_b.gif"/>
        </div>
        <a id="btnRefresh" href="#" class="btn btn-danger pull-right" onclick="refresh();return false;">Refresh</a>
    </div>
</div>

<div id="container" class="container-fluid">



    <p> -- Debug : <span id="debug">NONE</span> --</p>

    <div id="noConnection" class="text-center" style="display: none">
        <img class="text-center" src="img/nonetwork.jpg" style="width: 200px; height: 200px"/><br>
        No connection available
    </div>
    <div id="Connection" class="text-center " >
        <img class="text-center blinkinf" src="img/network.png" style="width: 200px; height: 200px"/><br><br>
        Waiting for notifications
    </div>


    <div class="row-fluid">
        <div class="span10">
            <div id="listNotif" class="row-fluid">

                <!--
                <ul class="thumbnails">
                    <li class="span4">
                        <div class="thumbnail">
                            <img data-src="holder.js/300x200" style="width: 300px; height: 150px;" src="img/shop.jpg">
                            <div class="caption">
                                <h3>Wanna go shopping ?</h3>
                                <p>I have found your shopping list and you still have items to buy. Here is a shop where you can go !</p>
                                <p><a href="#" class="btn btn-danger">Take me there !</a></p>
                            </div>
                        </div>
                    </li>
                </ul>

                <ul class="thumbnails">
                    <li class="span4">
                        <div class="thumbnail">
                            <img data-src="holder.js/300x200" style="width: 300px; height: 150px;" src="img/movie.jpg">
                            <div class="caption">
                                <h3>Want to see a movie ?</h3>
                                <p>I know that you are interested in Sci-Fi movies, why don't you check this one out ?</p>
                                <p><a href="#" class="btn btn-danger">Take me there !</a></p>
                            </div>
                        </div>
                    </li>
                </ul>   -->

            </div>
        </div>
    </div>
</div>




<script>

    setInterval(refresh,20000);

    function refresh() {
        document.getElementById("loader").style.display = 'inline';
        //checkConnection();
        $.support.cors = true;

        promise.get('http://tuple-center.herokuapp.com/take/user1/notifications.json?passwd=356a192b7913b04c54574d18c28d46e6395428ab').then(function(error, text, xhr) {
            if (error) {
                alert('Error ' + xhr.status);
                return;
            }
            $("#debug").html(text.length);
            alert('The page contains ' + text.length + ' character(s).');
        });


        /*$.ajax({
            success: function (data) {
                var jsonArray = data;
                //alert(document.getElementById("listNotif").childNodes.length);

                if (jsonArray.length > 1) {
                    // We have some notifications
                    document.getElementById('Connection').style.display = 'none';
                } else if (document.getElementById("listNotif").childNodes.length <= 3) {
                    document.getElementById('Connection').style.display = 'block';
                }


                for (var i=1; i < jsonArray.length; i++){
                    var values = jsonArray[i].value.split('##');
                    insertElem(values[0],values[2],'eat.jpg');
                }
                setTimeout(function()
                        {
                            document.getElementById("loader").style.display = 'none';
                        },
                        2000);
            },
            error: function (req, status) {
                alert("error");
                setTimeout(function()
                        {
                            document.getElementById("loader").style.display = 'none';
                        },
                        2000);
            },
            cache: false,
            url: "http://tuple-center.herokuapp.com/take/user1/notifications.json?passwd=356a192b7913b04c54574d18c28d46e6395428ab"
        });  */

    }

    function insertElem(title, content, imglink) {
        var listToInsert = document.getElementById("listNotif");
        var insertBefore = listToInsert.childNodes[1];

        var ulToInsert = document.createElement("ul");
        ulToInsert.className = "thumbnails blink1";

        var liToInsert = document.createElement("li");
        liToInsert.className = "span4";
        var divToInsert = document.createElement("div");
        divToInsert.className = "thumbnail";


        var img = document.createElement("img");
        img.src = "img/" + imglink;
        img.style.height = '150px';
        img.style.width = '300px';

        var titlecaption = document.createElement("h3");
        titlecaption.innerHTML = title;

        var contentcaption = document.createElement("p");
        contentcaption.innerHTML = content;

        var buttoncaption = document.createElement("p");
        buttoncaption.innerHTML = '<a href="#" class="btn btn-danger">Take me there !</a>';

        var caption = document.createElement("div");
        caption.className = "caption"
        caption.appendChild(titlecaption);
        caption.appendChild(contentcaption);
        caption.appendChild(buttoncaption);

        divToInsert.appendChild(img);
        divToInsert.appendChild(caption);
        liToInsert.appendChild(divToInsert);
        ulToInsert.appendChild(liToInsert);

        listToInsert.insertBefore(ulToInsert, insertBefore);
    }


    function checkConnection() {
        var networkState = navigator.network.connection.type;

        /*var states = {};
         states[Connection.UNKNOWN]  = 'Unknown connection';
         states[Connection.ETHERNET] = 'Ethernet connection';
         states[Connection.WIFI]     = 'WiFi connection';
         states[Connection.CELL_2G]  = 'Cell 2G connection';
         states[Connection.CELL_3G]  = 'Cell 3G connection';
         states[Connection.CELL_4G]  = 'Cell 4G connection';
         states[Connection.NONE]     = 'No network connection';   */

        /*if (networkState != Connection.NONE && networkState != Connection.CELL_2G) {

         document.getElementById('noConnection').style.display = 'none';
         document.getElementById('Connection').style.display = 'block';
         } else {
         document.getElementById('noConnection').style.display = 'block';
         document.getElementById('Connection').style.display = 'none';
         }  */
    }

</script>


</body>
</html>
