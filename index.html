<!DOCTYPE html>
<html data-jqm-ver="v13" lang="en">
<head>
    <title>iscrollview Demo</title>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>

    <link href="css/jquery.mobile-1.3.1.min.css" rel="stylesheet" media="screen">
    <link href="css/jquery.mobile.iscrollview.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/jquery.mobile.iscrollview-pull.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap.min_b.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">

    <script src="phonegap.js"></script>
    <script src="libs/jquery-1.7.1.js"></script>
    <script src="js/jquery.mobile.min.js"></script>
    <script src="js/promise.min.js"></script>
    <script src="libs/iscroll.js"></script>
    <script src="js/demo.js" type="text/javascript"></script>
    <script src="js/jquery.mobile.iscrollview.js" type="text/javascript"></script>
    <script src="js/pull-example.js" type="text/javascript"></script>
    <script src="js/jquery.ui.map.full.min.js" type="text/javascript"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>

    <script type="text/javascript">

        function getParameterByName( name,href )
        {
            name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
            var regexS = "[\\?&]"+name+"=([^&#]*)";
            var regex = new RegExp( regexS );
            var results = regex.exec( href );
            if( results == null )
                return "";
            else
                return decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        function initialize(latlong) {
            $('#map_canvas').gmap({'center': latlong, 'zoom': 16});
        }

        var fillVal = function(obj) {
            var val = obj.getAttribute('val');
            $("#divVal").html(val);
        };

        $(document).on("pagebeforeshow", "#elem", function() {

            var values = $("#divVal").html().split("##");

            $("#elemTitle").html(values[0]);
            $("#elemContent").html(values[2]+".");

            var gpsData = values[3].split('$$');
            var yourStartLatLng = new google.maps.LatLng(gpsData[0].split(',')[0], gpsData[0].split(',')[1]);


            initialize(yourStartLatLng);
            $('#map_canvas').addEventListener('touchstart' /*'mousedown'*/, function(e) {
                e.stopPropagation();
            }, false);

            $('#map_canvas').gmap().bind('init', function(evt, map) {
                for (var i=1; i < gpsData.length; i++){
                    var lat = gpsData[i].split(',')[0];
                    var long = gpsData[i].split(',')[1];
                    var title = gpsData[i].split(',')[2];
                    $('#map_canvas').gmap('addMarker', { /*id:'m_1',*/ 'position': lat + ',' + long , 'bounds': true } ).click(function() {
                        $('#map_canvas').gmap('openInfoWindow', { 'content': title }, this);
                    });
                }
            });

        });


    </script>
</head>

<body>
<div class="pull-demo-page" data-role="page" id="main">
    <div data-id="header" data-position="fixed" data-role="header" data-tap-toggle="false" data-transition="none">
        <h1>Ublopia</h1> <a href="#elem?val=gnagna" data-transition="slide"> _PAGE2</a>
    </div>


    <div data-iscroll="" data-role="content">

        <div class="iscroll-pulldown">
            <span class="iscroll-pull-icon"></span><span class="iscroll-pull-label"></span>
        </div>

        <ul id="thelist" >
            <li class="noNotif">
                <img src="img/network.png">
                No notification available. Pull down to reload.
            </li>
        </ul>
    </div>


</div>


<div data-role="page" id="elem" data-theme="a">

    <div data-position="fixed" data-role="header" data-tap-toggle="false" data-transition="none">
        <a href="#main" data-direction="reverse" data-role="button" data-theme="b" data-transition="slide" data-icon="arrow-l">Back</a>
        <h1 >Details</h1>
    </div><!-- /header -->

    <div data-iscroll="" data-role="content" data-theme="a">
        <ul class="elemDetails" data-role="listview">
            <li>
                <h2 id="elemTitle">My title</h2>
                <p id="elemContent">Here goes the content of my notification ! I have similar situation. I found that column index is changed after refresh method. This is probably a bug on this method somehow. I just load rows dynamically and until refresh method is called Headers are toggled fine (correct indexes) but only headers. To allow hide also columns in data rows I have to user refresh method, and afterwards indexes are not correct anymore.</p>
                <div id="map_canvas"></div>
            </li>
        </ul>
    </div><!-- /content -->



</div>

<div id="divVal" style="display: none"/>

</body>
</html>