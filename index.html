
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>iScroll demo: simple</title>

    <script src="phonegap.js"></script>
    <script src="libs/jquery-1.7.1.js"></script>
    <script src="js/jquery.mobile.min"></script>
    <script src="libs/iscroll.js"></script>
    <script src="js/promise.min.js"></script>


    <script type="text/javascript">

        var myScroll,
                pullDownEl, pullDownOffset,
                generatedCount = 0;

        function pullDownAction () {

            $.support.cors = true;
            promise.ajaxTimeout = 10000;
            promise.get('http://tuple-center.herokuapp.com/take/user1/notifications.json?passwd=356a192b7913b04c54574d18c28d46e6395428ab&random='+Math.random()).then(function(error, text, xhr) {




                //     if (error) {
//                $("#debug").html('ERROR');
//                document.getElementById("loader").style.display = 'none';
//                document.getElementById("issueNetwork").style.display = 'inline';
//                return;
//            }

                var jsonArray = JSON.parse(text);

                if (jsonArray.length > 1) {
                    // We have some notifications
                    $(".noNotif").hide();
                } else if (document.getElementById('thelist').childNodes.length <= 3 ) {
                    //alert(document.getElementById('thelist').childNodes.length);
                    $(".noNotif").show();
                }
                var el, li;


                for (var i=1; i < jsonArray.length; i++){
                    var values = jsonArray[i].value.split('##');
                    el = document.getElementById('thelist');
                    li = document.createElement('li');
                    li.innerHTML = '<img src="img/eat2.jpg" class="shadow"/></li>';
                    el.insertBefore(li, el.childNodes[0]);

                    //         // TODO => change this li
                    //html += "<li class='containerShadow' id='" + values[0]
                    //        + "'onclick='renderDetails(" + '\"' + values + "\")'>";
                    //         html += '<div class="thumbnail">';
                    //html += '<img src="img/eat2.jpg" class="shadow"/></li>';
                    //          html += '<div class="caption">';
                    //          html += '<h3>'+values[0]+'</h3>';
                    //          html += '<p>'+values[2]+'</p>';
                    //          html += '<a href="#" class="btn btn-danger btn-large">Take me there !</a>';
                    //html += '</li>';

                }
            });

            setTimeout( function(){
                myScroll.refresh() ;
            } , 500 ) ;
        }


        function loaded() {
            pullDownEl = document.getElementById('pullDown');
            pullDownOffset = pullDownEl.offsetHeight;


            myScroll = new iScroll('wrapper', {
                useTransition: true,
                topOffset: pullDownOffset,
                onRefresh: function () {
                    if (pullDownEl.className.match('loading')) {
                        pullDownEl.className = '';
                        pullDownEl.querySelector('.pullDownLabel').innerHTML = 'Pull down to refresh...';
                    }
                },
                onScrollMove: function () {
                    if (this.y > 5 && !pullDownEl.className.match('flip')) {
                        pullDownEl.className = 'flip';
                        pullDownEl.querySelector('.pullDownLabel').innerHTML = 'Release to refresh...';
                        this.minScrollY = 0;
                    } else if (this.y < 5 && pullDownEl.className.match('flip')) {
                        pullDownEl.className = '';
                        pullDownEl.querySelector('.pullDownLabel').innerHTML = 'Pull down to refresh...';
                        this.minScrollY = -pullDownOffset;
                    }
                },
                onScrollEnd: function () {
                    if (pullDownEl.className.match('flip')) {
                        pullDownEl.className = 'loading';
                        pullDownEl.querySelector('.pullDownLabel').innerHTML = 'Loading...';
                        pullDownAction();	// Execute custom function (ajax call?)
                    }
                }
            });

            setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
        }

        //document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);

        document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
    </script>


    <link href="css/bootstrap.min_b.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <link href="css/jquery.mobile.min.css" rel="stylesheet" media="screen">

</head>
<body>

<div id="header">Ublopia</div>
<div id="wrapper">
    <div id="scroller">
        <div id="pullDown">
            <span class="pullDownIcon"></span><span class="pullDownLabel">Pull down to refresh...</span>
        </div>

        <ul id="thelist">
            <li class="noNotif">
                <img src="img/network.png">
                No notification available.
            </li>
        </ul>
    </div>
</div>

</body>
</html>